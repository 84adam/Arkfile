# Arkfile Privacy Overview

This document explains, in plain language, how Arkfile keeps user data private.

## 1. Zero-Knowledge Philosophy

Arkfile is designed so the server never sees unencrypted content or user passwords.

All sensitive processing happens on the client side before any data leaves the user's device.

## 2. Password Protection

Arkfile uses different password protection approaches depending on the type of access:

**Account and Custom Passwords** use the **OPAQUE** protocol â€“ a modern "password-authenticated key exchange". Your password is never sent to the server in any form, and OPAQUE handles authentication with built-in validation requiring 14+ character passwords with strong entropy. This provides complete protection against offline attacks even if server data is compromised.

**Share Passwords** use Argon2id for anonymous file access, requiring 18+ character passwords with strong entropy validation. While these passwords enable anonymous sharing without account creation, they are protected by memory-intensive hashing that makes offline attacks computationally expensive and limited to shared files only.

## 3. File Encryption

Every file is encrypted **client-side** via WebAssembly code compiled from the Go crypto package.

| Step | Detail |
|------|--------|
| Key generation | A fresh 256-bit random key is created for **each file**. |
| Key derivation | The key is wrapped using session keys derived from OPAQUE authentication so only that user can decrypt it. |
| Encryption | File chunks (16 MB) are sealed with **AES-256-GCM**, providing confidentiality and integrity. |
| Upload | Only the ciphertext is transmitted and stored on the server or S3-compatible back-ends. |

Because every file has its own key, a breach of one key cannot unlock any other files.

## 4. Secure Sharing

When you create a share link Arkfile generates an **additional** key, unique to that share.

Recipients decrypt the file with this secondary key; your primary password remains secret.

Links can have expiry dates and can be revoked at any time.

## 5. Username-Based Accounts

Arkfile uses **usernames** as the primary account identifier, not email addresses.

**Email addresses are optional** and are only stored if the user chooses to provide one for account recovery purposes. The system is designed to function fully without requiring any email address.

This approach enhances privacy by:
- Reducing personal information stored on servers
- Eliminating potential email-based tracking
- Allowing truly anonymous account creation
- Reducing data exposure in case of server compromise

## 6. Minimal Metadata

The server stores only what it needs to function:

| Metadata | Purpose |
|----------|---------|
| Username | Account identification (chosen by user, not email) |
| Email address | Optional - only for account recovery if provided |
| Filename & size | Display in file lists; allow progress tracking. |
| Timestamps | Show upload date and enable cleanup tasks. |
| Anonymised entity ID | See Logging section below. |

No plaintext content, passwords, or encryption keys are stored server-side.

## 7. Privacy-Preserving Logging

Arkfile deliberately excludes client IP addresses from logs.

Instead, each request is tagged with an **entity ID** generated by a daily-rotating HMAC key (`logging/entity_id.go`).

This identifier lets the system spot suspicious behaviour patterns without exposing personal data.

Event records are written to:

* `security_events` rqlite table  
* JSON log files in `/var/log/arkfile/`

Operators can export these logs to external analytics or alerting tools; raw user identifiers are never present.

```sql
-- Example: list failed logins in the past hour
SELECT entity_id, count(*) AS failures
FROM security_events
WHERE event_type = 'opaque_login_failure'
  AND timestamp > datetime('now', '-1 hour');
```

## 8. File Size Padding

To prevent attackers from identifying files by their exact size, Arkfile implements a sophisticated file size padding system that obscures the true size of uploaded files while maintaining storage efficiency.

**Padding Methodology:**
Files are padded using a tiered approach that balances privacy protection with storage efficiency. The system applies padding to the nearest size tier, with tiers defined as 64KB, 1MB, 10MB, and 100MB blocks. Within each tier, an additional random padding of 0-10% is applied to prevent exact size correlation attacks.

**Storage Layer Implementation:**
The padding occurs exclusively at the storage backend level, meaning that encrypted file data stored in MinIO or other S3-compatible services includes this privacy-enhancing padding. However, all user-facing interfaces, storage quotas, and utilization calculations operate on the original file sizes, ensuring users are not penalized for privacy protection.

**Privacy Benefits:**
This approach prevents several classes of attacks including file fingerprinting based on exact byte counts, correlation attacks across multiple uploads of the same file, and metadata inference attacks that attempt to determine file types or contents based on size patterns. The random component within each tier ensures that even identical files do not produce identical storage footprints.

## 9. Storage Back-Ends

Arkfile supports multiple S3-compatible services (MinIO, Backblaze B2, Wasabi, Vultr).

Encrypted file data is opaque to the storage provider; none of them receive decryption keys.

## 10. Glossary

- **Zero-knowledge:** The server never possesses the information needed to decrypt user data.
- **OPAQUE:** A protocol that lets users prove they know their password without revealing it.
- **AES-256-GCM:** An encryption mode that hides data and detects tampering in one step.
- **HMAC:** A keyed hash that turns input (e.g., an IP address) into an irreversible digest.
- **Entity ID:** A short, daily-rotating code derived from the user's IP; used in logs instead of raw IP or username.
- **Ciphertext:** The scrambled output of an encryption algorithm.

---

Arkfile's architecture ensures that even if servers or storage providers are compromised, attackers cannot read user files or passwords without access to client-side secrets.

---

## Support

Questions, comments or bug reports? Email **arkfile [at] pm [dot] me** or open an issue on GitHub.  

Please avoid posting sensitive information in public issues.
