# Arkfile Privacy Overview

This document explains, in plain language, how Arkfile keeps user data private.  
It is written for business and technical leaders alike, avoiding deep cryptography jargon while still providing concrete details.

## 1. Zero-Knowledge Philosophy

Arkfile is designed so the server never sees unencrypted content or user passwords.  
All sensitive processing happens on the client (browser or desktop app) before any data leaves the user’s device.

## 2. Password Protection

Arkfile uses the **OPAQUE** protocol – a modern “password-authenticated key exchange”.  
• Your password is never sent to the server, not even in hashed form.  
• Before OPAQUE runs, the client strengthens the password with **Argon2id** (128 MB memory, 4 iterations by default).  
This combination defends against offline guessing if server data is ever stolen.

## 3. File Encryption

Every file is encrypted **client-side** via WebAssembly code compiled from the Go crypto package.

| Step | Detail |
|------|--------|
| Key generation | A fresh 256-bit random key is created for **each file**. |
| Key derivation | The key is wrapped with Argon2id using the user’s master password so only that user can decrypt it. |
| Encryption | File chunks (16 MB) are sealed with **AES-256-GCM**, providing confidentiality and integrity. |
| Upload | Only the ciphertext is transmitted and stored on the server or S3-compatible back-ends. |

Because every file has its own key, a breach of one key cannot unlock any other files.

## 4. Secure Sharing

When you create a share link Arkfile generates an **additional** key, unique to that share.  
Recipients decrypt the file with this secondary key; your primary password remains secret.  
Links can have expiry dates and can be revoked at any time.

## 5. Minimal Metadata

The server stores only what it needs to function:

| Metadata | Purpose |
|----------|---------|
| Filename & size | Display in file lists; allow progress tracking. |
| Timestamps | Show upload date and enable cleanup tasks. |
| Anonymised entity ID | See Logging section below. |

No plaintext content, passwords, or encryption keys are stored server-side.

## 6. Privacy-Preserving Logging

Arkfile deliberately excludes client IP addresses from logs.  
Instead, each request is tagged with an **entity ID** generated by a daily-rotating HMAC key (`logging/entity_id.go`).  
This identifier lets the system spot suspicious behaviour patterns without exposing personal data.  
Event records are written to:

* `security_events` rqlite table  
* JSON log files in `/var/log/arkfile/`

Operators can export these logs to external analytics or alerting tools; raw user identifiers are never present.

```sql
-- Example: list failed logins in the past hour
SELECT entity_id, count(*) AS failures
FROM security_events
WHERE event_type = 'opaque_login_failure'
  AND timestamp > datetime('now', '-1 hour');
```

## 7. Storage Back-Ends

Arkfile supports multiple S3-compatible services (MinIO, Backblaze B2, Wasabi, Vultr).  
Encrypted file data is opaque to the storage provider; none of them receive decryption keys.

## 8. Glossary

- **Zero-knowledge:** The server never possesses the information needed to decrypt user data.
- **OPAQUE:** A protocol that lets users prove they know their password without revealing it.
- **Argon2id:** A CPU- and memory-intensive function that turns a password into a strong cryptographic key.
- **AES-256-GCM:** An encryption mode that hides data and detects tampering in one step.
- **HMAC:** A keyed hash that turns input (e.g., an IP address) into an irreversible digest.
- **Entity ID:** A short, daily-rotating code derived from the user’s IP; used in logs instead of raw IP or email.
- **Ciphertext:** The scrambled output of an encryption algorithm.

---

Arkfile’s architecture ensures that even if servers or storage providers are compromised, attackers cannot read user files or passwords without access to client-side secrets.

---

## Support

Questions or bug reports?  
Email **arkfile [at] pm [dot] me** or open an issue on GitHub.  
Please avoid posting sensitive information in public issues.

---

*make yourself an ark of cypress wood*